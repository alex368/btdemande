{% extends 'base.html.twig' %}

{% block title %}Créer un contact{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="mb-4">Créer un contact</h1>

    <div class="card shadow-sm">
        <div class="card-body">

            {{ form_start(form) }}

            {# ------- IDENTITÉ -------- #}
            <div class="row">
                <div class="col-md-4">
                    {{ form_row(form.salutation) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.lastName) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.firstName) }}
                </div>
            </div>

            <hr>

            {# ------- EMAILS -------- #}
            <h5 class="mt-3"><i class="bi bi-envelope"></i> E-mails</h5>

            <div id="email-wrapper"
                 data-prototype="{{ form_widget(form.email.vars.prototype)|e('html_attr') }}"
                 data-index="{{ form.email|length }}">

                {% for emailField in form.email %}
                    <div class="d-flex gap-2 mb-2">
                        {{ form_widget(emailField) }}
                        <button type="button" class="btn btn-danger btn-sm remove-item">X</button>
                    </div>
                {% endfor %}
            </div>

            <button type="button" class="btn btn-sm btn-primary mt-2" id="add-email">
                Ajouter un email
            </button>

            <hr>

            {# ------- TELEPHONES / MOBILES -------- #}
            <div class="row mt-4">
                <div class="col-md-6">
                    <h5><i class="bi bi-telephone"></i> Téléphones</h5>

                    <div id="phone-wrapper"
                         data-prototype="{{ form_widget(form.phone.vars.prototype)|e('html_attr') }}"
                         data-index="{{ form.phone|length }}">

                        {% for phoneField in form.phone %}
                            <div class="d-flex gap-2 mb-2">
                                {{ form_widget(phoneField) }}
                                <button type="button" class="btn btn-danger btn-sm remove-item">X</button>
                            </div>
                        {% endfor %}
                    </div>

                    <button type="button" class="btn btn-sm btn-primary mt-2" id="add-phone">
                        Ajouter un numéro
                    </button>
                </div>

                <div class="col-md-6">
                    <h5><i class="bi bi-phone"></i> Mobiles</h5>

                    <div id="mobile-wrapper"
                         data-prototype="{{ form_widget(form.mobilePhone.vars.prototype)|e('html_attr') }}"
                         data-index="{{ form.mobilePhone|length }}">

                        {% for mobileField in form.mobilePhone %}
                            <div class="d-flex gap-2 mb-2">
                                {{ form_widget(mobileField) }}
                                <button type="button" class="btn btn-danger btn-sm remove-item">X</button>
                            </div>
                        {% endfor %}
                    </div>

                    <button type="button" class="btn btn-sm btn-primary mt-2" id="add-mobile">
                        Ajouter un mobile
                    </button>
                </div>
            </div>

            <hr>

            {# ------- RÉSEAUX SOCIAUX -------- #}
            <h5 class="mt-4"><i class="bi bi-share"></i> Réseaux sociaux</h5>

            <div id="social-wrapper"
                 data-prototype="{{ form_widget(form.socialMedia.vars.prototype)|e('html_attr') }}"
                 data-index="{{ form.socialMedia|length }}">

                {% for socialField in form.socialMedia %}
                    <div class="d-flex gap-2 mb-2">
                        {{ form_widget(socialField) }}
                        <button type="button" class="btn btn-danger btn-sm remove-item">X</button>
                    </div>
                {% endfor %}
            </div>

            <button type="button" class="btn btn-sm btn-primary mt-2" id="add-social">
                Ajouter un réseau social
            </button>

            <hr>

            {# ------- ADRESSE -------- #}
            <div class="row mt-4">
                <div class="col-md-4">
                    {{ form_row(form.country) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.city) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.adress) }}
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-md-6">
                    {{ form_row(form.occupation) }}
                </div>

                <div class="col-md-6">
                    {{ form_row(form.campany) }}
                </div>
            </div>

            <button class="btn btn-primary mt-3">
                <i class="bi bi-check2-circle"></i> Créer
            </button>

            {{ form_end(form) }}

        </div>
    </div>
</div>

{# ---------------------------- JS COLLECTIONS ----------------------------- #}
<script>
function addItem(wrapperId) {
    const wrapper = document.getElementById(wrapperId);
    const prototype = wrapper.dataset.prototype;
    const index = wrapper.dataset.index;

    const newForm = prototype.replace(/__name__/g, index);
    wrapper.dataset.index = parseInt(index) + 1;

    const div = document.createElement('div');
    div.classList.add('d-flex', 'gap-2', 'mb-2');
    div.innerHTML = newForm + '<button type="button" class="btn btn-danger btn-sm remove-item">X</button>';

    wrapper.appendChild(div);
}

document.getElementById('add-email').addEventListener('click', () => addItem('email-wrapper'));
document.getElementById('add-phone').addEventListener('click', () => addItem('phone-wrapper'));
document.getElementById('add-mobile').addEventListener('click', () => addItem('mobile-wrapper'));
document.getElementById('add-social').addEventListener('click', () => addItem('social-wrapper'));

document.addEventListener('click', (e) => {
    if (e.target.classList.contains('remove-item')) {
        e.target.parentNode.remove();
    }
});
</script>

{% endblock %}
