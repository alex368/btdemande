{% extends 'base.html.twig' %}

{% block title %}Nouvelle Activité{% endblock %}

{% block body %}
<div class="container mt-4">

    <h1 class="mb-4">Modifier une Activité pour {{ contact.firstName }} {{ contact.lastName }}</h1>

    <div class="card">
        <div class="card-body">

            {{ form_start(form) }}

                {{ form_widget(form) }}

                <button class="btn btn-primary mt-3">Enregistrer</button>

                <a href="{{ path('app_contact_show', { id: contact.id }) }}"
                   class="btn btn-secondary mt-3">
                    Retour au contact
                </a>

            {{ form_end(form) }}

        </div>
    </div>

</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {# ✅ Chargement de TinyMCE depuis le CDN officiel #}
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

    <script>
        function enhanceEditors() {
            if (typeof tinymce === "undefined") return;

            // Supprimer les instances existantes pour éviter les doublons
            tinymce.remove();

            document.querySelectorAll('textarea.wysiwyg[data-editor="tinymce"]').forEach(el => {
                if (!el.id) {
                    el.id = 'tinymce-' + Math.random().toString(36).substring(2, 9);
                }

                tinymce.init({
                    target: el,
                    height: 300,
                    menubar: false,
                    branding: false,
                    plugins: 'lists link image media code table codesample',
                    toolbar: 'undo redo | styleselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | code',
                    paste_data_images: true,
                    automatic_uploads: true,
                    images_upload_url: '/upload/image',
                    setup: (editor) => {
                        editor.on('change', () => editor.save());
                    }
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            enhanceEditors();
        });
    </script>
{% endblock %}
